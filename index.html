<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase 实时聊天室</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #chatBox {
            border: 1px solid #ccc;
            height: 300px;
            width: 100%;
            overflow-y: scroll;
            padding: 10px;
            margin-bottom: 10px;
        }
        #messageInput {
            width: 80%;
            padding: 10px;
            font-size: 1rem;
        }
        button {
            padding: 10px 20px;
            font-size: 1rem;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>

    <h1>实时聊天室</h1>

    <!-- 聊天消息显示区域 -->
    <div id="chatBox"></div>

    <!-- 消息输入框和发送按钮 -->
    <input type="text" id="messageInput" placeholder="输入你的消息">
    <button onclick="sendMessage()">发送</button>

    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyDHozncxr7awutjtusJ0q9DvKic2RFU5es",
            authDomain: "chat-81183.firebaseapp.com",
            databaseURL: "https://chat-81183-default-rtdb.firebaseio.com",
            projectId: "chat-81183",
            storageBucket: "chat-81183.appspot.com",
            messagingSenderId: "811608476194",
            appId: "1:811608476194:web:5128ed924c6fdfdf9c187b",
            measurementId: "G-K77BPG8ZES"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // 获取 DOM 元素
        const chatBox = document.getElementById('chatBox');
        const messageInput = document.getElementById('messageInput');

        // 发送消息到数据库
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message !== "") {
                const messageRef = push(ref(database, 'messages/'));
                set(messageRef, {
                    userId: 'user' + Math.floor(Math.random() * 1000), // 随机生成用户ID
                    message: message,
                    timestamp: new Date().toLocaleString()
                });
                messageInput.value = "";  // 清空输入框
            }
        }

        // 监听数据库中的消息，并显示在聊天框中
        const messageListRef = ref(database, 'messages/');
        onValue(messageListRef, (snapshot) => {
            const data = snapshot.val();
            chatBox.innerHTML = "";  // 每次更新都清空聊天框
            for (const key in data) {
                const message = data[key];
                const div = document.createElement('div');
                div.className = 'message';
                div.innerHTML = `<strong>${message.userId}:</strong> ${message.message} <br><small>${message.timestamp}</small>`;
                chatBox.appendChild(div);
            }
            chatBox.scrollTop = chatBox.scrollHeight;  // 自动滚动到最新消息
        });
    </script>
</body>
</html>
